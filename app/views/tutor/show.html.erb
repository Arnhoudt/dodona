<html>
  <head>
    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>

      <script>
      $(document).ready(function() {
          $.ajax({
              type: 'POST',
              url: 'http://localhost:8080/cgi-bin/build_trace.py',
              dataType: 'json',
              data: {username: 'dieter'},
              success: function(data) {
                  createTutor(data)
              },
              error: function(data) {
                  console.log("An error occured building tutor traceback")
              }
          })

          //var codeTrace = JSON.parse(<%= @json_traceback %>);
          var createTutor = function(codeTrace) {
            var visualizer = new ExecutionVisualizer('tutorelement', codeTrace,
                                                          {embeddedMode: false,
                                                           heightChangeCallback: redrawAllVisualizerArrows,
                                                           editCodeBaseURL: ''});

            function redrawAllVisualizerArrows() {
                if (visualizer) visualizer.redrawConnectors();
            }
            // Call redrawConnectors() on all visualizers whenever the window is resized,
            // since HTML elements might have moved during a resize. The SVG arrows rendered
            // by jsPlumb don't automatically get re-drawn in their new positions unless
            // redrawConnectors() is called.
            $(window).resize(redrawAllVisualizerArrows);
            $('#tutorelement').scroll(redrawAllVisualizerArrows);
          }
      });
      </script>
  </head>
  <body>
      <div id="tutorelement" style="overflow-x: scroll;"></div>
  </body>
  </html>
