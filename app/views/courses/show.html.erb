<div class="row">
  <%= link_to '#series', class: "btn btn-lg btn-down col-sm-1 hidden-xs", title: t('.series') do %>
    <span class='hidden-sm'><%= t ".series" %></span><br>
    <span class="glyphicon glyphicon-chevron-down"></span>
  <% end %>

  <div class="col-sm-10 col-xs-12">
    <div class="card">
      <div class="card-title card-title-colored">
        <h2 class="card-title-text"><%= @course.name %> (<%= @course.formatted_year %>)</h2>
        <% if policy(@course).edit? %>
          <div class="card-title-fab">
            <%= render 'fab_link', url: edit_course_path(@course), icon: 'pencil' %>
          </div>
        <% end %>
      </div>
      <% if !@course.description.blank? || (current_user && !current_user.member_of?(@course)) %>
        <div class="card-supporting-text row">
          <div class="col-sm-<%= (current_user && !current_user.member_of?(@course)) ? '6' : '12' %> col-xs-12">
            <%= markdown(@course.description) %>
          </div>
          <% if current_user && !current_user.member_of?(@course) %>
          <div class="col-sm-6 col-xs-12">
            <div class="card">
              <div class="card-supporting-text">
                <p><%= t ".not_a_member" %></p>
              </div>
              <div class="card-actions card-border">
                <%=link_to t(".subscribe"), subscribe_course_path(@course), method: :post, class: "btn-text" %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      <% end %>
      <div class="card-supporting-text card-border">
        <div class="card-subtitle">
          <a class="anchor" id="series"></a>
          <h3><%= t ".exercise_series" %></h3>
          <div class="flex-spacer"></div>
          <div class="card-subtitle-actions">
            <% if policy(@course).add_series? %>
              <%= link_to new_course_series_path(@course), title: t("series.new.title") do %>
                <span class='glyphicon glyphicon-plus pull-right'></span>
              <% end %>
            <% end %>
          </div>
        </div>
        <% policy_scope(@course.series).each do |series| %>
          <div class="card-subtitle">
            <a class="anchor" id="series-<%= series.name.parameterize %>"></a>
            <h4><%= series.name %>
              <% if series.deadline? %>
                <% if series.deadline > Time.now %>
                  <%= "<small class='deadline-ok' title='deadline #{t ".deadline_in"} #{time_ago_in_words series.deadline}'><span class='glyphicon glyphicon-time'></span> #{l series.deadline, format: :long}</small>".html_safe %>
                <% else %>
                  <%= "<small class='deadline-passed' title='deadline was #{time_ago_in_words series.deadline} #{t 'series.deadline.ago'} '><span class='glyphicon glyphicon-time'></span> #{l series.deadline, format: :long}</small>".html_safe %>
                <% end %>
              <% end %>
            </h4>
            <div class="flex-spacer"></div>
            <div class="card-subtitle-actions">
              <div class="btn-group">
                <a class="btn btn-icon dropdown-toggle" data-toggle="dropdown">
                  <span class='glyphicon glyphicon-option-vertical'></span>
                </a>
                <ul class="dropdown-menu dropdown-menu-right">
                  <% if policy(series).edit? %>
                    <li>
                      <%= link_to edit_series_path(series) do %>
                        <span class='glyphicon glyphicon-pencil'></span> <%= t("series.edit.title") %>
                      <% end %>
                    </li>
                  <% end %>
                  <% if policy(series).download_solutions? %>
                    <li>
                      <%= link_to download_solutions_series_path(series) do %>
                        <span class='glyphicon glyphicon-download-alt'></span> <%= t("series.show.download_solutions") %>
                      <% end %>
                    </li>
                  <% end %>
                </ul>
              </div>
            </div>
          </div>
          <% if current_user && current_user.admin? && !series.open?%>
            <div class="alert alert-info"><%= t ".series_not_visible" %></div>
          <% end %>
          <%= markdown(series.description) %>
          <%= render(partial: "exercises/exercises_table", locals: {exercises: series.exercises, series: series}) if series.exercises.length > 0 %>
        <% end %>
      </div>
      <% if policy(@course).list_members? %>
        <div class="card-supporting-text card-border">
          <h3><%= t ".users" %></h3>
          <p>
            <strong><%= t ".auto_subscribe_link" %>:</strong> <%= subscribe_with_secret_course_url(@course.id, @course.secret) %>
          </p>
          <%= render(partial: 'layouts/searchbar', locals: {baseUrl: users_path(course_id: @course.id), eager: true}) %>
          <div id="users-table-wrapper">
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
