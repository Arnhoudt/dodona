<div class="row">
  <%= link_to '#series', class: "btn btn-lg btn-down col-sm-1 hidden-xs", title: t('.series') do %>
    <span class='hidden-sm'><%= t ".series" %></span><br>
    <span class="glyphicon glyphicon-chevron-down"></span>
  <% end %>

  <div class="col-sm-10 col-xs-12">
    <div class="card">
      <div class="card-title card-title-colored">
        <h2 class="card-title-text"><%= @course.name %></h2>
        <% if policy(@course).edit? %>
          <div class="card-title-fab">
            <%= render 'fab_link', url: edit_course_path(@course), icon: 'pencil' %>
          </div>
        <% end %>
      </div>
      <div class="card-supporting-text row">
        <div class="col-sm-6 col-xs-12">
          <p>
            <strong><%= t ".course" %>:</strong> <%= @course.name %>
          </p>
          <p>
            <strong><%= Course.human_attribute_name("year") %>:</strong> <%= @course.year %>
          </p>
          <% if current_user && current_user.admin? %>
          <p>
            <strong><%= t ".auto_subscribe_link" %>:</strong> <%= request.protocol + request.host + subscribe_with_secret_course_path(@course.id, @course.secret) %>
          </p>
          <% end %>
        </div>
        <% if current_user && !current_user.member_of?(@course) %>
        <div class="col-sm-6 col-xs-12">
          <div class="card">
            <div class="card-supporting-text">
              <p><%= t ".not_a_member" %></p>
            </div>
            <div class="card-actions card-border">
              <%=link_to t(".subscribe"), subscribe_course_path(@course), method: :post, class: "btn-text" %>
            </div>
          </div>
        </div>
        <% end %>
      </div>
      <div class="card-supporting-text card-border">
        <div class="card-subtitle">
          <a class="anchor" id="series"></a>
          <h3><%= t ".exercise_series" %></h3>
          <div class="flex-spacer"></div>
          <div class="card-subtitle-actions">
            <% if policy(@course).add_series? %>
              <%= link_to new_course_series_path(@course), title: t("series.new.title") do %>
                <span class='glyphicon glyphicon-plus pull-right'></span>
              <% end %>
            <% end %>
          </div>
        </div>
        <% policy_scope(@course.series).each do |series| %>
          <div class="card-subtitle">
            <a class="anchor" id="series-<%= series.name.parameterize %>"></a>
            <h4><%= series.name %></h4>
            <div class="flex-spacer"></div>
            <div class="card-subtitle-actions">
              <% if policy(series).edit? %>
                <%= link_to edit_series_path(series), title: t("series.edit.title") do %>
                  <span class='glyphicon glyphicon-pencil pull-right'></span>
                <% end %>
              <% end %>
            </div>
          </div>
          <% if current_user && current_user.admin? && !series.open?%>
            <div class="alert alert-info"><%= t ".series_not_visible" %></div>
          <% end %>
          <%= markdown(series.description) %>
          <%= render(partial: "exercises/exercises_table", locals: {exercises: series.exercises}) if series.exercises.length > 0 %>
        <% end %>
      </div>
      <% if policy(@course).list_members? %>
        <div class="card-supporting-text card-border">
          <h3><%= t ".users" %></h3>
          <table class="table table-index table-resource">
            <thead>
              <tr>
                <th><%= User.human_attribute_name("username") %></th>
                <th><%= User.human_attribute_name("name") %></th>
                <th><%= User.human_attribute_name("email") %></th>
              </tr>
            </thead>
            <tbody>
              <% @course.users.each do |user| %>
                <tr>
                  <td><%= link_to user.username, user %></td>
                  <td><%= user.full_name %> </td>
                  <td><%= user.email %> </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% end %>
    </div>
  </div>
</div>
